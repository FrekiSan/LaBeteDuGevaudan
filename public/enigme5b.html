
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>√ânigme 5</title>
  <link rel="icon" href="assets/img/favicon.ico">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/responsive.css">
    <script src="assets/js/flecheDirectionHandler.js" defer></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      setupFleches(["gauche", "bas", "droite", "haut", "gauche"], () => {
        window.location.href = "enigme6a.html";
      });
    });
  </script>
<script src="assets/js/auth.fix.js" defer></script>
<script src="assets/js/flow.fix.js" defer></script>
</head>
<body>
    <header>
  <img src="assets/img/logo.png" alt="logo" class="logo">
  <nav class="header-links">
    <a href="#" id="openLogin" data-auth="guest" onclick="openModal('loginModal')">Se connecter</a>
    <a href="#" id="logoutBtn" data-auth="logged" style="display:none;">Se d√©connecter</a>
    <a href="#" id="openContact">Contact</a>
    <a href="#" id="openCredits">Cr√©dits</a>
    <a href="#" id="openClassement">Classement</a>
  </nav>
  <span id="timer" style="margin-left:12px;font-weight:bold;"></span>
  </header>
  
  <h1>√ânigme 5</h1>
<div class="spoiler spoiler-block"><img src="assets/img/Fin_Enigme_2_3_5_6/ImageFinalEnigme5-1_Poup√©es-Russe_.jpg" style="max-width:100%;height:auto" alt="Image indice (spoiler)"></div>


  <div class="video-container">
    <iframe width="560" height="315" src="https://www.youtube.com/embed/9aZGmRbL8RQ"  allowfullscreen></iframe>
  </div>

    <div id="sequence-affichee" style="margin: 1em 0; font-size: 1.3em; font-weight: bold;color:#f39c12;"></div>
    <div id="arrows">
      <button class="arrow-button" onclick="addDirection('haut')">‚Üë</button><br>
      <button class="arrow-button" onclick="addDirection('gauche')">‚Üê</button>
      <button class="arrow-button" onclick="addDirection('bas')">‚Üì</button>
      <button class="arrow-button" onclick="addDirection('droite')">‚Üí</button><br>
      <button onclick="validateFleches()">Valider</button>
      <button onclick="resetFleches()">R√©initialiser</button>
    </div>

    <div id="video" style="display:none;">
      <iframe src="https://www.youtube.com/embed/ciEChQK9rJI" title="Vid√©o Histoire 5"  allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>

    <footer>
    <!--Preuve v√©rificator-->
<p>
    <a href="https://jigsaw.w3.org/css-validator/check/referer">
        <img style="border:0;width:88px;height:31px"
            src="https://jigsaw.w3.org/css-validator/images/vcss-blue"
            alt="Valid CSS!" />
    </a>
</p>
  </footer>


<!-- üî≤ Overlay -->
<div id="modalOverlay" class="modal-overlay"></div>

<!-- üîê Modal Login -->
<div id="loginModal" class="modal">
  <h2>Connexion</h2>
  <form id="loginForm">
    <input type="text" name="username" placeholder="Pseudo" required><br>
    <input type="email" name="email" placeholder="Email (optionnel)"><br>
    <input type="password" name="password" placeholder="Mot de passe" required><br>
    <button type="submit">Se connecter</button>
    <button type="button" id="registerBtn">Cr√©er un compte</button>
  </form>
  <p id="loginMsg" style="margin-top:8px;color:#9ecbff;"></p>
</div>

<!-- üìá Modal Cr√©dits -->
<div id="modalCredits" class="modal">
  <h2>Cr√©dits</h2>
  <p>Escape Game r√©alis√© par <b>Groom Escape</b> (<i>Yann S. & Maxime "Freki" Orange</i>)<br>
     Cod√© par <b>Anima'Escape</b> (<i>Maxime "Freki" Orange</i>)<br>
     Acteurs : Hafid D., Yann S., Maxime "Freki" Orange<br>
     <i>Escape r√©alis√© en collaboration avec la ville de Clermont-Ferrand (f√©vrier 2020)</i>
  </p>
</div>

<!-- üì¨ Modal Contact -->
<div id="modalContact" class="modal">
  <h2>Contact</h2>
  <form>
    <input type="text" placeholder="Votre nom" required><br>
    <input type="email" placeholder="Votre email" required><br>
    <textarea placeholder="Votre message" required></textarea><br>
    <button type="submit">Envoyer</button>
  </form>
</div>

<!-- üèÜ Modal Classement -->
<div id="classementModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('classementModal')">&times;</span>
    <h2>Classement</h2>
    <ul id="classementList" class="leaderboard"></ul>
  </div>
</div>



<script src="assets/js/global_timer.js" defer></script>


<script>
  (function(){
    function setAuthUI(isLoggedIn, username) {
      var loginLink = document.querySelector('a[onclick*="openModal(\'loginModal\')"]');
      var logoutBtn = document.getElementById("logoutBtn");
      if (isLoggedIn) {
        if (loginLink) loginLink.style.display = "none";
        if (logoutBtn) {
          logoutBtn.style.display = "inline-block";
          logoutBtn.textContent = "Se d√©connecter " + (username ? "(" + username + ")" : "(joueur)");
        }
      } else {
        if (loginLink) loginLink.style.display = "inline-block";
        if (logoutBtn) logoutBtn.style.display = "none";
      }
    }
    function getCurrentUser() {
      try { return JSON.parse(localStorage.getItem("currentUser") || "null"); }
      catch (e) { return null; }
    }
    function initAuthBindings() {
      var loginForm = document.getElementById("loginForm");
      if (loginForm) {
        loginForm.addEventListener("submit", function(e){
          e.preventDefault();
          var data = {};
          try {
            var fd = new FormData(loginForm);
            fd.forEach(function(v,k){ data[k]=v; });
          } catch (e) {}
          var user = { username: data.username || data.email || "joueur", email: data.email || "", ts: Date.now() };
          localStorage.setItem("currentUser", JSON.stringify(user));
          setAuthUI(true, user.username);
          if (typeof closeModal === "function") closeModal("loginModal");
        });
      }
      var logoutBtn = document.getElementById("logoutBtn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", function(){
          localStorage.removeItem("currentUser");
          setAuthUI(false);
        });
      }
      var u = getCurrentUser();
      setAuthUI(!!u, u && u.username);
    }
    document.addEventListener("DOMContentLoaded", initAuthBindings);
  })();
</script>


<style>
.spoiler-wrap{
  position:relative;
  display:inline-block;
  max-width:100%;
}
.spoiler-wrap img.spoilered{
  filter:blur(14px) brightness(0.7);
  transition:filter .25s ease;
  cursor:pointer;
}
.spoiler-wrap.revealed img.spoilered{
  filter:none;
}
.spoiler-badge{
  position:absolute;
  left:50%;top:50%;
  transform:translate(-50%,-50%);
  padding:.5rem .75rem;
  background:rgba(0,0,0,.7);
  color:#fff;
  border-radius:.5rem;
  font-size:.9rem;
  user-select:none;
  pointer-events:none;
}
.spoiler-hint{
  position:absolute;
  right:.5rem;bottom:.5rem;
  background:rgba(0,0,0,.55);
  color:#fff;
  padding:.25rem .5rem;
  border-radius:.375rem;
  font-size:.75rem;
  pointer-events:none;
  }
</style>
<script>
(function(){
  function shouldSpoiler(img){
    if (!img) return false;
    if (img.dataset && (img.dataset.nospoiler==="1" || img.dataset.nospoiler==="true")) return false;
    var cls = (img.className||"").toLowerCase();
    if (/(logo|favicon|icon)/.test(cls)) return false;
    var src = (img.getAttribute("src")||"").toLowerCase();
    if (/(logo|favicon|icon|header)/.test(src)) return false;
    // Skip very small images (likely UI)
    if (img.naturalWidth && img.naturalWidth < 64) return false;
    // If inside header/nav/footer
    var el = img;
    while (el){
      var tag = (el.tagName||"").toLowerCase();
      var id = (el.id||"").toLowerCase();
      var c = (el.className||"").toLowerCase();
      if (/(header|nav|footer)/.test(tag) || /(header|nav|footer)/.test(id) || /(header|nav|footer)/.test(c)) return false;
      el = el.parentElement;
    }
    return true;
  }
  function wrapSpoiler(img){
    if (img.closest('.spoiler-wrap')) return;
    var wrap = document.createElement('div');
    wrap.className = 'spoiler-wrap';
    var badge = document.createElement('div');
    badge.className = 'spoiler-badge';
    badge.textContent = 'Image masqu√©e';
    var hint = document.createElement('div');
    hint.className = 'spoiler-hint';
    hint.textContent = 'Cliquer pour r√©v√©ler';
    img.classList.add('spoilered');
    img.parentNode.insertBefore(wrap, img);
    wrap.appendChild(img);
    wrap.appendChild(badge);
    wrap.appendChild(hint);
    wrap.addEventListener('click', function(){
      wrap.classList.toggle('revealed');
    });
  }
  function initSpoilers(){
    var imgs = Array.prototype.slice.call(document.images || []);
    imgs.forEach(function(img){
      if (shouldSpoiler(img)) {
        if (img.complete) {
          wrapSpoiler(img);
        } else {
          img.addEventListener('load', function(){ wrapSpoiler(img); }, {once:true});
        }
      }
    });
  }
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', initSpoilers);
  } else {
    initSpoilers();
  }
})();
</script>


<script>
(function(){
  var expected=["gauche", "bas", "droite", "haut", "gauche"].map(function(s){return s.toLowerCase();});
  var current=[];
  function render(){ var el=document.getElementById('sequence-affichee'); if(el) el.textContent=current.join(' ¬∑ '); }
  window.addDirection=function(dir){ dir=(dir||'').toLowerCase(); current.push(dir); render(); };
  window.resetFleches=function(){ current=[]; render(); };
  window.validateFleches=function(){ 
    var ok = expected.length===current.length && expected.every(function(v,i){return v===current[i];});
    if(ok){ var v=document.getElementById('video'); if(v) v.style.display='block'; revealStory(); scheduleRedirect('enigme6a.html',70000); } 
  };
  document.addEventListener('DOMContentLoaded', render);
})();
</script>

</body>
</html>
